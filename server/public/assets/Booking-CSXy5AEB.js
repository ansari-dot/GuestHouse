import{o as $,p as U,y as G,q as R,r as m,s as H,I as q,H as c,j as e,J as V,K as z,l as J,k as K,M as Q,N as W}from"./index-JLmx17Az.js";import{m as X}from"./proxy-dBKeKQzG.js";const re=()=>{var C,I,P,D,S;const g=$(),N=U(),h=G(),{rooms:u,loading:Z,error:ee}=R(a=>a.rooms),{user:d}=R(a=>a.auth),r=(C=h.state)==null?void 0:C.selectedRoom,O=(I=h.state)==null?void 0:I.roomId;(P=h.state)==null||P.roomType,(D=h.state)==null||D.roomPrice,(S=h.state)==null||S.roomNumber;const[s,x]=m.useState({roomId:O||"",checkIn:"",checkOut:"",guests:(r==null?void 0:r.capacity)||1,name:(d==null?void 0:d.username)||"",email:(d==null?void 0:d.email)||"",phone:"",specialRequests:"",paymentMethod:"",cardNumber:"",expiryDate:"",cvv:"",paypalEmail:"",totalAmount:0}),[t,f]=m.useState(r||null),[A,y]=m.useState(0),[j,v]=m.useState(0),[se,M]=m.useState(null),[ae,B]=m.useState("pending"),[k,b]=m.useState(!1),F="http://localhost:3000";m.useEffect(()=>{g(H()),E()},[g]),m.useEffect(()=>{if(r)f(r),x(a=>({...a,roomId:r._id||r.id,guests:r.capacity||1}));else if(s.roomId&&Array.isArray(u)){const a=u.find(n=>(n._id||n.id)===s.roomId);f(a)}},[s.roomId,u,r]),m.useEffect(()=>{if(s.checkIn&&s.checkOut&&t){const a=new Date(s.checkIn),i=new Date(s.checkOut).getTime()-a.getTime(),l=Math.ceil(i/(1e3*3600*24));if(l>0){v(l);const p=l*t.price;y(p),x(Y=>({...Y,totalAmount:p}))}else v(0),y(0),x(p=>({...p,totalAmount:0}))}},[s.checkIn,s.checkOut,t]);const E=async()=>{const a=new URLSearchParams(window.location.search),n=a.get("bookingId"),i=a.get("status");if(n&&i)try{if(i==="success"){const l=a.get("transaction_id");(await q.post("/booking/verify-payment",{bookingId:n,transactionId:l})).data.success?(c.success("Payment confirmed! Your booking is now confirmed.",{position:"top-right",autoClose:3e3,theme:"light"}),B("confirmed")):c.error("Payment verification failed. Please contact support.",{position:"top-right",autoClose:3e3,theme:"light"})}else i==="failed"&&c.error("Payment failed. Please try again.",{position:"top-right",autoClose:3e3,theme:"light"});window.history.replaceState({},document.title,window.location.pathname)}catch(l){console.error("Payment status check error:",l)}},o=a=>{const{name:n,value:i}=a.target;x(l=>({...l,[n]:i}))},_=()=>s.roomId?!s.checkIn||!s.checkOut?(c.error("Please select check-in and check-out dates"),!1):!s.name||!s.email||!s.phone?(c.error("Please fill in all required guest information"),!1):s.paymentMethod?s.paymentMethod==="credit_card"&&(!s.cardNumber||!s.expiryDate||!s.cvv)?(c.error("Please fill in all credit card details"),!1):s.paymentMethod==="paypal"&&!s.paypalEmail?(c.error("Please enter your PayPal email"),!1):!0:(c.error("Please select a payment method"),!1):(c.error("Please select a room"),!1),L=async a=>{var n,i;if(a.preventDefault(),b(!0),!d){c.warn("Please log in to submit a booking request.",{position:"top-right",autoClose:3e3,theme:"light"}),N("/login");return}if(!_()){b(!1);return}try{const l=await q.post("/booking",s,{headers:{"Content-Type":"application/json"}});l.data.success?s.paymentMethod==="fastpay"&&l.data.paymentUrl?window.location.href=l.data.paymentUrl:(c.success(s.paymentMethod==="cash_on_arrival"?"Your booking has been confirmed!":"Your booking request has been submitted successfully!",{position:"top-right",autoClose:3e3,theme:"light"}),M(l.data.bookingId)):c.error(l.data.message||"Your booking request has failed! Please try again.",{position:"top-right",autoClose:3e3,theme:"light"})}catch(l){console.error("Booking error:",l),c.error(((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to submit booking. Please try again.",{position:"top-right",autoClose:3e3,theme:"light"})}finally{b(!1)}},w=()=>{const a=new Date;return a.setDate(a.getDate()+1),a.toISOString().split("T")[0]},T=()=>{if(s.checkIn){const a=new Date(s.checkIn);return a.setDate(a.getDate()+1),a.toISOString().split("T")[0]}return w()};return e.jsxs(X.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:[e.jsx(V,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsx("section",{className:"page-hero",style:{backgroundImage:"url(https://images.pexels.com/photos/338504/pexels-photo-338504.jpeg)"},children:e.jsx("div",{className:"hero-slide",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12 text-center",children:[e.jsx("h1",{className:"display-3 text-white mb-4",children:"Book Your Stay"}),e.jsx("nav",{"aria-label":"breadcrumb",children:e.jsxs("ol",{className:"breadcrumb justify-content-center",children:[e.jsx("li",{className:"breadcrumb-item",children:e.jsx("a",{href:"/",className:"text-white",children:"Home"})}),e.jsx("li",{className:"breadcrumb-item active text-secondary","aria-current":"page",children:"Booking"})]})})]})})})})}),e.jsx("section",{className:"py-5",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{className:"btn btn-outline-secondary",onClick:()=>N("/rooms"),children:[e.jsx(z,{className:"me-2"}),"Back to Rooms"]})}),t&&e.jsx("div",{className:"card border-0 shadow mb-4","data-aos":"fade-up",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title text-primary mb-3",children:"Selected Room"}),e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("img",{src:t.image?`${F}/uploads/${t.image}`:"/default-room.jpg",alt:t.type,className:"img-fluid rounded",style:{height:"120px",objectFit:"cover",width:"100%"}})}),e.jsxs("div",{className:"col-md-9",children:[e.jsxs("h6",{className:"mb-2",children:[t.type," - Room #",t.roomNumber]}),e.jsx("p",{className:"text-muted mb-2",children:t.description}),e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("div",{children:[e.jsxs("span",{className:"badge bg-primary me-2",children:["$",t.price,"/night"]}),e.jsxs("span",{className:"badge bg-secondary me-2",children:[t.capacity," Guests"]}),e.jsxs("span",{className:"badge bg-info",children:[t.size," sq ft"]})]})})]})]})]})}),e.jsxs("div",{className:"row g-5",children:[e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"card border-0 shadow","data-aos":"fade-up",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h3",{className:"card-title text-primary mb-4",children:"Reservation Details"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"mb-4 pb-4 border-bottom",children:[e.jsxs("h5",{className:"d-flex align-items-center mb-3",children:[e.jsx(J,{className:"me-2 text-secondary"}),"Select Room"]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:r?e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Pre-selected Room:"})," ",r.type," - Room #",r.roomNumber," ($",r.price,"/night)"]}):e.jsxs("select",{className:"form-select",name:"roomId",value:s.roomId,onChange:o,required:!0,children:[e.jsx("option",{value:"",children:"Choose a room"}),Array.isArray(u)&&u.map(a=>e.jsxs("option",{value:a._id||a.id,children:[a.type||"Unnamed Room"," - Room #",a.roomNumber," - $",a.price||0,"/night"]},a._id||a.id))]})})})]}),e.jsxs("div",{className:"mb-4 pb-4 border-bottom",children:[e.jsxs("h5",{className:"d-flex align-items-center mb-3",children:[e.jsx(K,{className:"me-2 text-secondary"}),"Guest Information"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Full Name *"}),e.jsx("input",{type:"text",className:"form-control",name:"name",value:s.name,onChange:o,required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Email Address *"}),e.jsx("input",{type:"email",className:"form-control",name:"email",value:s.email,onChange:o,required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Phone Number *"}),e.jsx("input",{type:"tel",className:"form-control",name:"phone",value:s.phone,onChange:o,required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Number of Guests *"}),e.jsx("select",{className:"form-select",name:"guests",value:s.guests,onChange:o,required:!0,children:[1,2,3,4,5,6].map(a=>e.jsxs("option",{value:a,children:[a," Guest",a>1?"s":""]},a))})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-bottom",children:[e.jsxs("h5",{className:"d-flex align-items-center mb-3",children:[e.jsx(Q,{className:"me-2 text-secondary"}),"Booking Dates"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Check-in Date *"}),e.jsx("input",{type:"date",className:"form-control",name:"checkIn",value:s.checkIn,onChange:o,min:w(),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Check-out Date *"}),e.jsx("input",{type:"date",className:"form-control",name:"checkOut",value:s.checkOut,onChange:o,min:T(),required:!0})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-bottom",children:[e.jsxs("h5",{className:"d-flex align-items-center mb-3",children:[e.jsx(W,{className:"me-2 text-secondary"}),"Payment Method"]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("select",{className:"form-select",name:"paymentMethod",value:s.paymentMethod,onChange:o,required:!0,children:[e.jsx("option",{value:"",children:"Select payment method"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"paypal",children:"PayPal"}),e.jsx("option",{value:"fastpay",children:"FastPay (Pakistan)"}),e.jsx("option",{value:"cash_on_arrival",children:"Cash on Arrival"})]})}),s.paymentMethod==="credit_card"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Card Number *"}),e.jsx("input",{type:"text",className:"form-control",name:"cardNumber",value:s.cardNumber,onChange:o,placeholder:"1234 5678 9012 3456",maxLength:"19"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Expiry Date *"}),e.jsx("input",{type:"text",className:"form-control",name:"expiryDate",value:s.expiryDate,onChange:o,placeholder:"MM/YY",maxLength:"5"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"CVV *"}),e.jsx("input",{type:"text",className:"form-control",name:"cvv",value:s.cvv,onChange:o,placeholder:"123",maxLength:"4"})]})]}),s.paymentMethod==="paypal"&&e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"PayPal Email *"}),e.jsx("input",{type:"email",className:"form-control",name:"paypalEmail",value:s.paypalEmail,onChange:o,placeholder:"your-email@paypal.com"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Special Requests (Optional)"}),e.jsx("textarea",{className:"form-control",name:"specialRequests",value:s.specialRequests,onChange:o,rows:"3",placeholder:"Any special requests or requirements..."})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg w-100",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Processing Booking..."]}):"Confirm Booking"})]})]})})}),e.jsx("div",{className:"col-lg-4",children:e.jsx("div",{className:"card border-0 shadow","data-aos":"fade-up","data-aos-delay":"100",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h4",{className:"card-title text-primary mb-4",children:"Booking Summary"}),t&&e.jsxs("div",{className:"booking-summary",children:[e.jsxs("div",{className:"room-info mb-3",children:[e.jsx("h6",{className:"fw-bold",children:t.type||"Selected Room"}),e.jsxs("p",{className:"text-muted mb-2",children:["Room #",t.roomNumber||"N/A"," -"," ",t.capacity||0," Guests"]}),e.jsx("p",{className:"text-muted mb-0",children:t.description})]}),s.checkIn&&s.checkOut&&e.jsxs("div",{className:"booking-dates mb-3",children:[e.jsx("h6",{className:"fw-bold",children:"Dates"}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Check-in:"})," ",new Date(s.checkIn).toLocaleDateString()]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Check-out:"})," ",new Date(s.checkOut).toLocaleDateString()]}),e.jsxs("p",{className:"text-primary fw-bold",children:[j," night",j!==1?"s":""]})]}),e.jsxs("div",{className:"price-breakdown",children:[e.jsx("h6",{className:"fw-bold",children:"Price Breakdown"}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Room rate per night:"}),e.jsxs("span",{children:["$",t.price||0]})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Number of nights:"}),e.jsx("span",{children:j})]}),e.jsx("hr",{}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{className:"text-primary",children:["$",A]})]})]})]}),!t&&e.jsx("div",{className:"text-center text-muted",children:e.jsx("p",{children:"Please select a room to see booking summary"})})]})})})]})]})})]})};export{re as default};
