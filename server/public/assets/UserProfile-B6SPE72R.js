import{p as Q,o as X,q as Y,r,G as k,H as h,j as s,S as v,x as $,O as y,U as Z,z as ss,V as es,W as as,D as ts,v as rs}from"./index-cLXZ2XQB.js";import{m as S}from"./proxy-vYrq3Jt8.js";var F={};const is=()=>{const x=Q(),R=X(),{user:t}=Y(e=>e.auth),[d,P]=r.useState("profile"),[I,T]=r.useState([]),[j,g]=r.useState(!1),[b,u]=r.useState(""),[N,f]=r.useState(""),[l,_]=r.useState(!1),[D,B]=r.useState(null),[E,O]=r.useState(null),[m,L]=r.useState({username:"",email:"",phone:"",address:""}),[c,A]=r.useState({currentPassword:"",newPassword:"",confirmPassword:""}),q=E||(t!=null&&t.profileImage?`http://localhost:5000/uploads/${t.profileImage}`:"/default-avatar.png");r.useEffect(()=>{if(!t){x("/login");return}L({username:t.username||"",email:t.email||"",phone:t.phone||"",address:t.address||""}),H()},[t,x]);const H=async()=>{try{const e=await k.get(`${F.REACT_APP_API_URL}/api/bookings/user/${t.id}`);T(e.data)}catch{h.error("Failed to fetch bookings")}},z=e=>{const a=e.target.files[0];a&&(B(a),O(URL.createObjectURL(a)))},w=e=>{const{name:a,value:i}=e.target;L(o=>({...o,[a]:i}))},V=async e=>{var a,i,o,p;e.preventDefault(),g(!0),u(""),f("");try{const n=new FormData;Object.keys(m).forEach(U=>{n.append(U,m[U])}),D&&n.append("profileImage",D),await k.put(`${F.REACT_APP_API_URL}/api/users/profile`,n,{headers:{"Content-Type":"multipart/form-data"}}),f("Profile updated successfully"),_(!1),h.success("Profile updated successfully")}catch(n){u(((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to update profile"),h.error(((p=(o=n.response)==null?void 0:o.data)==null?void 0:p.message)||"Failed to update profile")}finally{g(!1)}},C=e=>{A(a=>({...a,[e.target.name]:e.target.value}))},G=async e=>{var a,i,o,p;if(e.preventDefault(),u(""),f(""),c.newPassword!==c.confirmPassword){u("New passwords do not match");return}g(!0);try{await k.post(`${F.REACT_APP_API_URL}/api/change-password`,{currentPassword:c.currentPassword,newPassword:c.newPassword}),f("Password changed successfully"),A({currentPassword:"",newPassword:"",confirmPassword:""}),h.success("Password changed successfully")}catch(n){u(((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to change password"),h.error(((p=(o=n.response)==null?void 0:o.data)==null?void 0:p.message)||"Failed to change password")}finally{g(!1)}},W=()=>{R({type:"auth/logout"}),h.success("Logged out successfully"),x("/login")},J=()=>s.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card shadow-sm",children:s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[s.jsx("h5",{className:"card-title mb-0",children:"Profile Information"}),s.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>_(!l),children:l?s.jsxs(s.Fragment,{children:[s.jsx(ss,{className:"me-1"})," Cancel"]}):s.jsxs(s.Fragment,{children:[s.jsx(es,{className:"me-1"})," Edit Profile"]})})]}),b&&s.jsx("div",{className:"alert alert-danger",role:"alert",children:b}),N&&s.jsx("div",{className:"alert alert-success",role:"alert",children:N}),s.jsxs("form",{onSubmit:V,children:[s.jsx("div",{className:"text-center mb-4",children:s.jsxs("div",{className:"position-relative d-inline-block",children:[s.jsx("img",{src:q,alt:"Profile",className:"rounded-circle",style:{width:"150px",height:"150px",objectFit:"cover"}}),l&&s.jsxs("label",{className:"position-absolute bottom-0 end-0 bg-primary text-white rounded-circle p-2",style:{cursor:"pointer"},children:[s.jsx(as,{}),s.jsx("input",{type:"file",className:"d-none",accept:"image/*",onChange:z})]})]})}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-6 mb-3",children:[s.jsx("label",{className:"form-label",children:"Username"}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(v,{})}),s.jsx("input",{type:"text",className:"form-control",name:"username",value:m.username,onChange:w,disabled:!l})]})]}),s.jsxs("div",{className:"col-md-6 mb-3",children:[s.jsx("label",{className:"form-label",children:"Email"}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(ts,{})}),s.jsx("input",{type:"email",className:"form-control",name:"email",value:m.email,onChange:w,disabled:!l})]})]}),s.jsxs("div",{className:"col-md-6 mb-3",children:[s.jsx("label",{className:"form-label",children:"Phone"}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(v,{})}),s.jsx("input",{type:"tel",className:"form-control",name:"phone",value:m.phone,onChange:w,disabled:!l})]})]}),s.jsxs("div",{className:"col-md-6 mb-3",children:[s.jsx("label",{className:"form-label",children:"Address"}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(v,{})}),s.jsx("input",{type:"text",className:"form-control",name:"address",value:m.address,onChange:w,disabled:!l})]})]})]}),l&&s.jsx("div",{className:"text-end mt-3",children:s.jsx("button",{type:"submit",className:"btn btn-primary",disabled:j,children:j?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Saving..."]}):s.jsxs(s.Fragment,{children:[s.jsx(rs,{className:"me-1"})," Save Changes"]})})})]})]})}),K=()=>s.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card shadow-sm",children:s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title mb-4",children:"Booking History"}),I.length===0?s.jsxs("div",{className:"text-center py-5",children:[s.jsx($,{className:"text-muted mb-3",style:{fontSize:"3rem"}}),s.jsx("p",{className:"text-muted",children:"No bookings found"})]}):s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table table-hover",children:[s.jsx("thead",{className:"table-light",children:s.jsxs("tr",{children:[s.jsx("th",{children:"Booking ID"}),s.jsx("th",{children:"Room"}),s.jsx("th",{children:"Check-in"}),s.jsx("th",{children:"Check-out"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:I.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:e._id}),s.jsx("td",{children:e.room.name}),s.jsx("td",{children:new Date(e.checkIn).toLocaleDateString()}),s.jsx("td",{children:new Date(e.checkOut).toLocaleDateString()}),s.jsx("td",{children:s.jsx("span",{className:`badge bg-${e.status==="confirmed"?"success":e.status==="pending"?"warning":"danger"}`,children:e.status})}),s.jsxs("td",{children:[s.jsx("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>x(`/booking/${e._id}`),children:"View"}),e.status==="pending"&&s.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>handleCancelBooking(e._id),children:"Cancel"})]})]},e._id))})]})})]})}),M=()=>s.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card shadow-sm",children:s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title mb-4",children:"Change Password"}),b&&s.jsx("div",{className:"alert alert-danger",role:"alert",children:b}),N&&s.jsx("div",{className:"alert alert-success",role:"alert",children:N}),s.jsxs("form",{onSubmit:G,children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Current Password"}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(y,{})}),s.jsx("input",{type:"password",className:"form-control",name:"currentPassword",value:c.currentPassword,onChange:C,required:!0})]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"New Password"}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(y,{})}),s.jsx("input",{type:"password",className:"form-control",name:"newPassword",value:c.newPassword,onChange:C,required:!0,minLength:"6"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"form-label",children:"Confirm New Password"}),s.jsxs("div",{className:"input-group",children:[s.jsx("span",{className:"input-group-text",children:s.jsx(y,{})}),s.jsx("input",{type:"password",className:"form-control",name:"confirmPassword",value:c.confirmPassword,onChange:C,required:!0,minLength:"6"})]})]}),s.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:j,children:j?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Changing Password..."]}):"Change Password"})]})]})});return s.jsx("div",{className:"container py-5",children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-lg-3 mb-4",children:s.jsx("div",{className:"card shadow-sm",children:s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"d-flex flex-column",children:[s.jsxs("button",{className:`btn btn-link text-start mb-2 ${d==="profile"?"active":""}`,onClick:()=>P("profile"),children:[s.jsx(v,{className:"me-2"})," Profile"]}),s.jsxs("button",{className:`btn btn-link text-start mb-2 ${d==="bookings"?"active":""}`,onClick:()=>P("bookings"),children:[s.jsx($,{className:"me-2"})," Bookings"]}),s.jsxs("button",{className:`btn btn-link text-start mb-2 ${d==="password"?"active":""}`,onClick:()=>P("password"),children:[s.jsx(y,{className:"me-2"})," Change Password"]}),s.jsxs("button",{className:"btn btn-link text-start text-danger",onClick:W,children:[s.jsx(Z,{className:"me-2"})," Logout"]})]})})})}),s.jsxs("div",{className:"col-lg-9",children:[d==="profile"&&J(),d==="bookings"&&K(),d==="password"&&M()]})]})})};export{is as default};
